<%inherit file="/master.html"/>

<%def name="head()">
<script src="/js/jquery-spin.js"></script>
<script language='javascript'>
function control_on_off(value_id, action, statusfield)
{
        
        $.ajax({
            type: "GET",            
            url: '/values/' + value_id + '?action=' + action, 
            success: function(data) {

                        if (data == 0) {
                            $('#' + statusfield).html("<font color='red'><b>Request failed!</b></font>");
                        } else {
                            if (action == "poweron") {
                                $('#' + statusfield).html("On");
                            } else if (action == "poweroff") {
                                $('#' + statusfield).html("Off");
                            }
                        }
                        
                     }
        });
}

function thermostat_set(plugin, address, device_id)
{
    temp = $('#stat' + device_id).val();
    
    var dataString = 'plugin=' + plugin + '&address=' + address + '&temp=' + temp
    
    $.ajax({
        type: "POST",
        url: "/control_stat",
        data: dataString,
        succes: function(data) {
            $('#status' + device_id).html(temp);
        }
    });

}
    
$(document).ready(function() 
{
    $('.spin').spin({
        imageBasePath: '/images/',
        interval: 0.1
    });

});
</script>
</%def>
<%def name="content()">
<table cellspacing="0" cellpadding="0" align="center" width="100%">
	<tbody>
		<tr>
			<td class="HeadText">Lighting and control devices</td>
		</tr>
		<tr>
			<td class="body info">
				<p>This page lists information about lighting and control devices, this basically is any device that has a controlable function. For example: light switches, dimmers, thermostats etc.</p>
			</td>
		</tr>
		<tr>
			<td class="body">
				<table class="InfoTable" cellspacing="0" cellpadding="0" border="0" width="100%">
					<tbody>
						<tr class="HeadTable">
							<td nowrap="" width="5%">Actions</td>
							<td nowrap="" width="5%">Device name</td>
							<td nowrap="" width="12%">Label</td>
							<td nowrap="" width="12%">Status</td>
						</tr>
						% for device in result:
						<tr class="Row">
							<td>
							
							% if device[4] == "CONTROL_TYPE_ON_OFF":
								<button onclick='javascript:control_on_off("${device[0]}", "poweron", "status${device[0]}");' class="ui-button ui-button-text-only ui-widget ui-state-default ui-corner-all">
								   <span class="ui-button-text">On</span>
								</button> 
								<button onclick='javascript:control_on_off("${device[0]}", "poweroff", "status${device[0]}");' class="ui-button ui-button-text-only ui-widget ui-state-default ui-corner-all">
								   <span class="ui-button-text">Off</span>
								</button>
							% elif device[4] == "CONTROL_TYPE_THERMOSTAT":
								<input value='${device[2]}' id='stat${device[0]}' size=1 type="input" class="spin" value="22" /> <button onclick='javascript:thermostat_set("${device[3]}", "${device[1]}", "${device[4]}");' class="ui-button ui-button-text-only ui-widget ui-state-default ui-corner-all"><span class="ui-button-text">Set</span></button>
							% endif					
							</td>

							<td>${device[1]}</td>
							<td>${device[2]}</td>
							<td id='status${device[0]}'>${device[4]}</td>
						</tr>
						% endfor
					</tbody>
				</table>
			</td>
		</tr>
	</tbody>
</table>
</%def>